<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8" />
    <title>äººå·¥ç„¡èƒ½ï¼šè¨€éœŠã®æ®‹éŸ¿</title>
    <style>
        body {
            font-family: sans-serif;
            margin: 2em;
            background: #fdf6e3;
        }

        #log {
            white-space: pre-wrap;
            border: 1px solid #aaa;
            padding: 1em;
            height: 300px;
            overflow-y: auto;
            background: #fff;
        }

        #input {
            width: 100%;
            padding: 0.5em;
            margin-top: 1em;
        }
    </style>
</head>

<body>
    <h1>ğŸº è³¢ç‹¼äººå·¥ç„¡èƒ½</h1>
    <div id="log">ğŸ‘¤ã€Œã“ã‚“ã«ã¡ã¯ã€<br />ğŸºã€Œã“ã‚“ã«ã¡ã¯ã€ã˜ã‚ƒãªï¼ã€</div>
    <input type="text" id="input" placeholder="è©±ã—ã‹ã‘ã¦ã¿ã¦ãã‚Šã‚ƒã‚Œâ€¦" />

    <script>
        const log = document.getElementById('log');
        const input = document.getElementById('input');

        let memory = [];

        function splitWords(text) {
            // æ–‡ã‚’å¥èª­ç‚¹ãƒ»ç©ºç™½ã§åˆ†å‰²ã—ã€é©å½“ã«é•·ã„å˜èªã¯åˆ†å‰²ã™ã‚‹
            return text
                .replace(/[ã€‚ã€ï¼ï¼Œ]/g, ' ')
                .split(/\s+/)
                .flatMap(word => {
                    if (word.length > 6) return word.match(/.{1,3}/g); // é•·ã„è¨€è‘‰ã¯3æ–‡å­—ãšã¤åˆ‡ã‚‹
                    return word;
                })
                .filter(Boolean);
        }

        function remember(words) {
            // å˜èªä½ç½®ã”ã¨ã«è¨˜æ†¶ï¼ˆå…ˆé ­/ä¸­é–“/æœ«å°¾ï¼‰
            words.forEach((word, i) => {
                const pos = i === 0 ? 'start' : (i === words.length - 1 ? 'end' : 'middle');
                memory.push({ word, pos });
                if (memory.length > 1000) memory.shift(); // å¿˜ã‚Œã‚‹
            });
        }

        function reply() {
            if (memory.length === 0) return "â€¦â€¦ã¾ã ä½•ã‚‚çŸ¥ã‚‰ã‚“ã®ã…ã€‚";
            // ãƒ©ãƒ³ãƒ€ãƒ ã«å‰ãƒ»ä¸­ãƒ»å¾Œã®å˜èªã‹ã‚‰é¸ã¶
            let choices = [];
            ['start', 'middle', 'end'].forEach(pos => {
                const group = memory.filter(m => m.pos === pos);
                if (group.length > 0) {
                    const word = group[Math.floor(Math.random() * group.length)].word;
                    choices.push(word);
                }
            });
            return choices.join('ã€') + 'ã€ã˜ã‚ƒãªã€‚';
        }

        input.addEventListener('keydown', e => {
            if (e.key === 'Enter') {
                const userText = input.value.trim();
                if (!userText) return;
                const words = splitWords(userText);
                remember(words);
                const response = reply();
                log.textContent += `\nğŸ‘¤ã€Œ${userText}ã€\nğŸºã€Œ${response}ã€`;
                input.value = '';
                log.scrollTop = log.scrollHeight;
            }
        });
    </script>
</body>

</html>